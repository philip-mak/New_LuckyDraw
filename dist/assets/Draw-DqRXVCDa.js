import{d as e,r as t,w as a,c as l,n as s,a as i,b as n,t as r,e as o,o as c,_ as d,u,f as g,g as p,h as m,i as x,j as v,k as b,l as y,m as f,p as h,v as w,F as k,q as D,s as C,x as S,y as M}from"./index-oZlgQK7v.js";import{u as z}from"./settings-B_R-dZIJ.js";const _={class:"text-center"},j={class:"w-12 h-12 bg-gradient-to-br from-blue-400 to-purple-500 rounded-full flex items-center justify-center mx-auto mb-3"},P={class:"text-white font-bold text-lg"},A={class:"font-semibold text-gray-900 text-sm mb-1 truncate"},I={key:0,class:"text-xs text-gray-600 truncate"},W={key:1,class:"text-xs text-gray-500 truncate mt-1"},$={key:2,class:"mt-1"},Q={class:"mt-2 space-y-1"},T={class:"text-xs text-gray-500 text-center"},F={key:3,class:"mt-2"},N=d(e({__name:"ParticipantCard",props:{participant:{},isSelected:{type:Boolean},isDrawing:{type:Boolean}},emits:["click","testAnimation"],setup(e,{emit:d}){const u=e,g=t(!1),p=()=>{console.log("ğŸ§ª Testing animation for:",u.participant.name),g.value=!0,setTimeout(()=>{g.value=!1,console.log("ğŸ§ª Test animation complete")},3e3)};return a([()=>u.isDrawing,()=>u.isSelected],([e,t],[a,l])=>{e===a&&t===l||console.log(`ğŸ­ ${u.participant.name}: Drawing=${e}, Selected=${t}`)},{immediate:!0}),(t,a)=>(c(),l("div",{class:s(["participant-card",{selected:e.isSelected&&!e.isDrawing,winner:e.participant.isWinner,"drawing-selected":e.isDrawing&&e.isSelected||g.value,"drawing-mode":e.isDrawing,"test-animating":g.value}]),onClick:a[0]||(a[0]=e=>t.$emit("click"))},[i("div",_,[i("div",j,[i("span",P,r(e.participant.name.charAt(0).toUpperCase()),1)]),i("h3",A,r(e.participant.name),1),e.participant.position?(c(),l("p",I,r(e.participant.position),1)):n("",!0),e.participant.group?(c(),l("p",W,r(e.participant.group),1)):n("",!0),e.isDrawing&&e.isSelected?(c(),l("div",$,[...a[1]||(a[1]=[i("span",{class:"inline-flex items-center px-2 py-1 rounded-full text-xs font-bold bg-red-500 text-white animate-pulse"}," ğŸ¯ æ­£åœ¨æŠ½é¸ ",-1)])])):n("",!0),i("div",Q,[i("button",{onClick:o(p,["stop"]),class:s(["w-full text-xs px-2 py-1 bg-blue-500 text-white rounded hover:bg-blue-600 font-bold",{"bg-red-500":g.value}])},r(g.value?"ğŸŒˆ å‹•ç•«ä¸­...":"ğŸ§ª æ¸¬è©¦å‹•ç•«"),3),i("div",T," D:"+r(e.isDrawing?"Y":"N")+" | S:"+r(e.isSelected?"Y":"N")+" | T:"+r(g.value?"Y":"N"),1)]),e.participant.isWinner?(c(),l("div",F,[...a[2]||(a[2]=[i("span",{class:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800"}," ğŸ† ç²çè€… ",-1)])])):n("",!0)])],2))}}),[["__scopeId","data-v-47e7bd9a"]]),Y={class:"min-h-screen bg-gradient-to-br from-purple-50 to-pink-100"},q={class:"bg-white shadow-sm border-b border-gray-200"},B={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"},U={class:"flex justify-between items-center py-4"},E={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8"},V={class:"card p-6 mb-8"},G={class:"flex flex-col md:flex-row justify-between items-center gap-4"},H={class:"text-gray-600"},J={class:"flex flex-col sm:flex-row gap-3 items-center"},K={class:"flex items-center gap-2"},L=["disabled"],O=["value"],R={class:"flex gap-3"},X=["disabled"],Z={key:0,class:"mt-4"},ee={class:"w-full bg-gray-200 rounded-full h-3 shadow-inner relative overflow-hidden"},te={class:"flex justify-between items-center mt-3"},ae={class:"text-sm text-gray-600 animate-pulse"},le={class:"text-sm font-medium text-blue-600"},se={key:0,class:"card p-6 mb-8 text-center"},ie={class:"text-2xl font-bold text-purple-600 mb-2"},ne={class:"text-gray-600"},re={class:"flex justify-center gap-4 mt-4"},oe={class:"text-sm text-gray-500"},ce={class:"text-sm text-blue-600"},de={key:0,class:"text-sm text-orange-600 mt-2"},ue={key:1,class:"card p-8 mb-8 text-center bg-gradient-to-r from-yellow-50 to-orange-50 border-2 border-yellow-200"},ge={class:"text-xl text-gray-700 mb-2"},pe={key:0,class:"text-lg text-gray-600 mb-4"},me={class:"text-lg font-semibold text-purple-600"},xe={key:2,class:"card p-8 mb-8 bg-gradient-to-r from-yellow-50 to-orange-50 border-2 border-yellow-200"},ve={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-6"},be={class:"font-bold text-lg text-gray-900"},ye={key:0,class:"text-sm text-gray-600"},fe={class:"text-purple-600 font-medium mt-2"},he={key:0,class:"absolute inset-0 pointer-events-none z-0 rounded-lg rainbow-background"},we={key:3,class:"text-center py-12"},ke=d(e({__name:"Draw",setup(e){const o=u(),d=g(),_=z(),j=t([]),P=t(1),A=t([]),{activeParticipants:I,winners:W,selectedParticipant:$,selectParticipant:Q,markAsWinner:T,clearSelection:F,resetAllWinners:ke}=o,{getNextAvailablePrize:De,consumePrize:Ce}=d,{settings:Se,isDrawing:Me,drawProgress:ze,startDrawing:_e,stopDrawing:je,updateDrawProgress:Pe}=_,Ae=p(()=>De()),Ie=p(()=>{const e=Math.min(I.length,20);return Array.from({length:e},(e,t)=>t+1)});let We=null;const $e=()=>{if(0===I.length||0===P.value)return;console.log("ğŸš€ Starting draw with",I.length,"participants"),We&&(console.log("âš ï¸ Clearing existing draw interval"),clearInterval(We),We=null),_e(),j.value=[],A.value=[],F(),setTimeout(()=>{We&&(console.log("ğŸš¨ Safety timeout: Force stopping draw after 10 seconds"),Te())},1e4);let e=0;const t=Se.animationDuration,a=100/t*100;console.log(`ğŸ¬ Starting draw animation: ${t}ms duration, 100ms intervals`),We=setInterval(()=>{if(e+=a,Pe(e),console.log(`â±ï¸ Animation progress: ${Math.round(e)}%`),e<90&&I.length>0){const t=Math.floor(Math.random()*I.length),a=I[t];console.log(`ï¿½ Selecting: ${a.name} (${Math.round(e)}%)`),Q(a.id)}e>=100&&(console.log("ğŸŠ Animation complete! Finalizing draw..."),Te())},100)},Qe=()=>{We&&(clearInterval(We),We=null),je(),Pe(0),j.value=[],F()},Te=()=>{console.log("ğŸ¯ Finalizing draw..."),We&&(clearInterval(We),We=null,console.log("âœ… Draw interval cleared")),je(),Pe(100),console.log("ğŸ“Š Progress set to 100%, drawing state stopped");const e=[...I],t=[],a=Ae.value?Math.min(P.value,Ae.value.remainingQuantity,e.length):Math.min(P.value,e.length);for(let l=0;l<a;l++){const a=Math.floor(Math.random()*e.length),l=e.splice(a,1)[0];Ae.value&&t.push({...l,prizeWon:Ae.value.title})}j.value=t},Fe=()=>{if(j.value.length>0&&Ae.value){j.value.forEach((e,t)=>{T(e.id,e.prizeWon)});for(let e=0;e<j.value.length;e++)Ae.value.remainingQuantity>0&&Ce(Ae.value.id);j.value=[],F()}},Ne=()=>{j.value=[],F(),I.length>0&&setTimeout(()=>$e(),500)},Ye=()=>{confirm("æ‚¨ç¢ºå®šè¦é‡è¨­æ‰€æœ‰ç²çè€…å—ï¼Ÿæ­¤æ“ä½œç„¡æ³•å¾©åŸã€‚")&&(ke(),d.resetAllPrizes(),j.value=[],F())};return a(()=>I.length,e=>{P.value>e&&(P.value=Math.max(1,e))}),m(()=>{We&&(clearInterval(We),We=null),je(),Pe(0),I.length>0&&(P.value=1)}),x(()=>{We&&(clearInterval(We),We=null),je(),Pe(0)}),(e,t)=>{const a=y("router-link");return c(),l("div",Y,[i("header",q,[i("div",B,[i("div",U,[t[2]||(t[2]=i("h1",{class:"text-2xl font-bold text-gray-900"},"ğŸ¯ å¹¸é‹æŠ½ç",-1)),v(a,{to:"/",class:"btn-secondary"},{default:b(()=>[...t[1]||(t[1]=[S("â† è¿”å›é¦–é ",-1)])]),_:1})])])]),i("main",E,[i("div",V,[i("div",G,[i("div",null,[t[3]||(t[3]=i("h2",{class:"text-xl font-semibold text-gray-900"},"æº–å‚™æŠ½çï¼Ÿ",-1)),i("p",H,"å‰©é¤˜ "+r(f(I).length)+" ååƒèˆ‡è€…",1)]),i("div",J,[i("div",K,[t[4]||(t[4]=i("label",{class:"text-sm font-medium text-gray-700 whitespace-nowrap"},"æŠ½å–äººæ•¸:",-1)),h(i("select",{"onUpdate:modelValue":t[0]||(t[0]=e=>P.value=e),disabled:f(Me),class:s(["p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm",{"opacity-50 cursor-not-allowed":f(Me)}])},[(c(!0),l(k,null,D(Ie.value,e=>(c(),l("option",{key:e,value:e},r(e)+" å ",9,O))),128))],10,L),[[w,P.value]])]),i("div",R,[f(Me)?(c(),l("button",{key:1,onClick:Qe,class:"btn-danger px-8 py-3 text-lg font-semibold"}," â¹ï¸ åœæ­¢æŠ½ç ")):(c(),l("button",{key:0,onClick:$e,disabled:0===f(I).length||0===P.value,class:s(["btn-primary px-8 py-3 text-lg font-semibold",{"opacity-50 cursor-not-allowed":0===f(I).length||0===P.value}])}," ğŸ² æŠ½å– "+r(P.value)+" å ",11,X)),f(W).length>0?(c(),l("button",{key:2,onClick:Ye,class:"btn-secondary"}," ğŸ”„ é‡è¨­æ‰€æœ‰ ")):n("",!0)])])]),f(Me)?(c(),l("div",Z,[i("div",ee,[i("div",{class:"h-3 rounded-full transition-all duration-100 rainbow-progress",style:C({width:f(ze)+"%"})},null,4)]),i("div",te,[i("p",ae," ğŸ² æ­£åœ¨æŠ½å– "+r(P.value)+" åç²çè€…... ",1),i("p",le,r(Math.round(f(ze)))+"% ",1)])])):n("",!0)]),Ae.value?(c(),l("div",se,[t[5]||(t[5]=i("h3",{class:"text-lg font-semibold text-gray-900 mb-2"},"ç•¶å‰çå“",-1)),i("div",ie,r(Ae.value.title),1),i("p",ne,r(Ae.value.description),1),i("div",re,[i("div",oe," å‰©é¤˜çå“: "+r(Ae.value.remainingQuantity)+" / "+r(Ae.value.quantity),1),i("div",ce," æœ¬æ¬¡æŠ½å–: "+r(Math.min(P.value,Ae.value.remainingQuantity))+" å ",1)]),P.value>Ae.value.remainingQuantity?(c(),l("div",de," âš ï¸ æŠ½å–äººæ•¸è¶…éå‰©é¤˜çå“æ•¸é‡ï¼Œå°‡èª¿æ•´ç‚º "+r(Ae.value.remainingQuantity)+" å ",1)):n("",!0)])):n("",!0),1===j.value.length?(c(),l("div",ue,[t[6]||(t[6]=i("div",{class:"text-6xl mb-4"},"ğŸ‰",-1)),t[7]||(t[7]=i("h3",{class:"text-3xl font-bold text-gray-900 mb-4"},"æ­å–œï¼",-1)),i("div",ge,r(j.value[0].name),1),j.value[0].position?(c(),l("div",pe,r(j.value[0].position),1)):n("",!0),i("div",me,"ç²ç: "+r(j.value[0].prizeWon),1),i("div",{class:"mt-6 flex justify-center gap-4"},[i("button",{onClick:Fe,class:"btn-primary"},"ç¢ºèªç²çè€…"),i("button",{onClick:Ne,class:"btn-secondary"},"é‡æ–°æŠ½ç")])])):j.value.length>1?(c(),l("div",xe,[t[9]||(t[9]=i("div",{class:"text-center"},[i("div",{class:"text-6xl mb-4"},"ğŸ‰"),i("h3",{class:"text-3xl font-bold text-gray-900 mb-6"},"æ­å–œæ‰€æœ‰ç²çè€…ï¼")],-1)),i("div",ve,[(c(!0),l(k,null,D(j.value,(e,a)=>(c(),l("div",{key:e.id,class:"bg-white p-4 rounded-lg border border-yellow-300 text-center"},[t[8]||(t[8]=i("div",{class:"text-2xl mb-2"},"ğŸ†",-1)),i("div",be,r(e.name),1),e.position?(c(),l("div",ye,r(e.position),1)):n("",!0),i("div",fe,r(e.prizeWon),1)]))),128))]),i("div",{class:"flex justify-center gap-4"},[i("button",{onClick:Fe,class:"btn-primary"},"ç¢ºèªæ‰€æœ‰ç²çè€…"),i("button",{onClick:Ne,class:"btn-secondary"},"é‡æ–°æŠ½ç")])])):n("",!0),i("div",{class:s(["grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4 relative",{"drawing-active":f(Me)}])},[f(Me)?(c(),l("div",he)):n("",!0),(c(!0),l(k,null,D(f(I),e=>{var t;return c(),M(N,{key:e.id,participant:e,"is-drawing":f(Me),"is-selected":(null==(t=f($))?void 0:t.id)===e.id||j.value.some(t=>t.id===e.id),onClick:t=>f(Q)(e.id),class:"relative z-10"},null,8,["participant","is-drawing","is-selected","onClick"])}),128))],2),0===f(I).length?(c(),l("div",we,[t[11]||(t[11]=i("div",{class:"text-6xl mb-4"},"ğŸ¯",-1)),t[12]||(t[12]=i("h3",{class:"text-xl font-semibold text-gray-900 mb-2"},"ç„¡å¯ç”¨åƒèˆ‡è€…",-1)),t[13]||(t[13]=i("p",{class:"text-gray-600 mb-4"},"æ–°å¢ä¸€äº›åƒèˆ‡è€…ä»¥é–‹å§‹å¹¸é‹æŠ½çï¼",-1)),v(a,{to:"/",class:"btn-primary"},{default:b(()=>[...t[10]||(t[10]=[S("æ–°å¢åƒèˆ‡è€…",-1)])]),_:1})])):n("",!0)])])}}}),[["__scopeId","data-v-e74710d6"]]);export{ke as default};
