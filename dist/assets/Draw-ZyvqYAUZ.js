import{d as e,u as t,a as l,r as a,s,c as i,w as n,o as r,b as o,e as c,f as d,g as u,h as v,i as g,t as m,j as x,k as b,v as p,n as y,F as f,l as h,m as w,p as k,q as C,x as P}from"./index-DRA9EFs8.js";import{u as j}from"./settings-BLZVTouT.js";import{P as M}from"./ParticipantCard-CuQ5p8Bm.js";const z={class:"min-h-screen christmas-bg"},D={class:"bg-white shadow-sm border-b border-gray-200"},Q={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"},W={class:"flex justify-between items-center py-4"},A={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8"},I={class:"card p-6 mb-8"},_={class:"flex flex-col md:flex-row justify-between items-center gap-4"},q={class:"text-gray-600"},E={class:"flex flex-col sm:flex-row gap-3 items-center"},F={class:"flex items-center gap-2"},N=["disabled"],S=["value"],T={class:"flex gap-3"},U=["disabled"],V={key:0,class:"mt-4"},B={class:"w-full bg-gray-200 rounded-full h-2"},G={class:"text-center text-sm text-gray-600 mt-2"},H={key:0,class:"card p-6 mb-8 text-center"},J={class:"text-2xl font-bold text-purple-600 mb-2"},K={class:"text-gray-600"},L={class:"flex justify-center gap-4 mt-4"},O={class:"text-sm text-gray-500"},R={class:"text-sm text-blue-600"},X={key:0,class:"text-sm text-orange-600 mt-2"},Y={key:1,class:"card p-8 mb-8 text-center bg-gradient-to-r from-yellow-50 to-orange-50 border-2 border-yellow-200"},Z={class:"text-xl text-gray-700 mb-2"},$={key:0,class:"text-lg text-gray-600 mb-4"},ee={class:"text-lg font-semibold text-purple-600"},te={key:2,class:"card p-8 mb-8 bg-gradient-to-r from-yellow-50 to-orange-50 border-2 border-yellow-200"},le={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-6"},ae={class:"font-bold text-lg text-gray-900"},se={key:0,class:"text-sm text-gray-600"},ie={class:"text-purple-600 font-medium mt-2"},ne={class:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4"},re={key:3,class:"text-center py-12"},oe=e({__name:"Draw",setup(e){const oe=t(),ce=l(),de=j(),ue=a([]),ve=a(1),ge=a([]),{activeParticipants:me,winners:xe,selectedParticipant:be}=s(oe),{selectParticipant:pe,markAsWinner:ye,clearSelection:fe,resetAllWinners:he}=oe,{getNextAvailablePrize:we,consumePrize:ke}=ce,{settings:Ce,isDrawing:Pe,drawProgress:je,startDrawing:Me,stopDrawing:ze,updateDrawProgress:De}=de,Qe=i(()=>we()),We=i(()=>{const e=Math.min(me.value.length,20);return Array.from({length:e},(e,t)=>t+1)});let Ae=null;const Ie=()=>{if(0===me.value.length||0===ve.value)return;Me(),ue.value=[],ge.value=[],fe();let e=0;const t=50/Ce.animationDuration*100;Ae=setInterval(()=>{if(e+=t,De(e),e<90){fe();const e=Math.floor(Math.random()*me.value.length),t=me.value[e];pe(t.id)}e>=100&&qe()},50)},_e=()=>{Ae&&(clearInterval(Ae),Ae=null),ze(),ue.value=[]},qe=()=>{Ae&&(clearInterval(Ae),Ae=null),ze(),fe();const e=[...me.value],t=[],l=Qe.value?Math.min(ve.value,Qe.value.remainingQuantity,e.length):Math.min(ve.value,e.length);for(let a=0;a<l;a++){const l=Math.floor(Math.random()*e.length),a=e.splice(l,1)[0];Qe.value&&t.push({...a,prizeWon:Qe.value.title})}ue.value=t},Ee=()=>{if(ue.value.length>0&&Qe.value){ue.value.forEach((e,t)=>{ye(e.id,e.prizeWon)});for(let e=0;e<ue.value.length;e++)Qe.value.remainingQuantity>0&&ke(Qe.value.id);ue.value=[],fe()}},Fe=()=>{ue.value=[],fe(),me.value.length>0&&setTimeout(()=>Ie(),500)},Ne=()=>{confirm("æ‚¨ç¢ºå®šè¦é‡è¨­æ‰€æœ‰ç²çè€…å—ï¼Ÿæ­¤æ“ä½œç„¡æ³•å¾©åŸã€‚")&&(he(),ce.resetAllPrizes(),ue.value=[],fe())};return n(()=>me.value.length,e=>{ve.value>e&&(ve.value=Math.max(1,e))}),r(()=>{Ae&&clearInterval(Ae),me.value.length>0&&(ve.value=1)}),(e,t)=>{const l=v("router-link");return P(),o("div",z,[c("header",D,[c("div",Q,[c("div",W,[t[2]||(t[2]=c("h1",{class:"text-2xl font-bold text-gray-900"},"ğŸ¯ å¹¸é‹æŠ½ç",-1)),d(l,{to:"/",class:"btn-secondary"},{default:u(()=>[...t[1]||(t[1]=[k("â† è¿”å›é¦–é ",-1)])]),_:1})])])]),c("main",A,[c("div",I,[c("div",_,[c("div",null,[t[3]||(t[3]=c("h2",{class:"text-xl font-semibold text-gray-900"},"æº–å‚™æŠ½çï¼Ÿ",-1)),c("p",q,"å‰©é¤˜ "+m(x(me).length)+" ååƒèˆ‡è€…",1)]),c("div",E,[c("div",F,[t[4]||(t[4]=c("label",{class:"text-sm font-medium text-gray-700 whitespace-nowrap"},"æŠ½å–äººæ•¸:",-1)),b(c("select",{"onUpdate:modelValue":t[0]||(t[0]=e=>ve.value=e),disabled:x(Pe),class:y(["p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm",{"opacity-50 cursor-not-allowed":x(Pe)}])},[(P(!0),o(f,null,h(We.value,e=>(P(),o("option",{key:e,value:e},m(e)+" å ",9,S))),128))],10,N),[[p,ve.value]])]),c("div",T,[x(Pe)?(P(),o("button",{key:1,onClick:_e,class:"btn-danger px-8 py-3 text-lg font-semibold"}," â¹ï¸ åœæ­¢æŠ½ç ")):(P(),o("button",{key:0,onClick:Ie,disabled:0===x(me).length||0===ve.value,class:y(["btn-primary px-8 py-3 text-lg font-semibold",{"opacity-50 cursor-not-allowed":0===x(me).length||0===ve.value}])}," ğŸ² æŠ½å– "+m(ve.value)+" å ",11,U)),x(xe).length>0?(P(),o("button",{key:2,onClick:Ne,class:"btn-secondary"}," ğŸ”„ é‡è¨­æ‰€æœ‰ ")):g("",!0)])])]),x(Pe)?(P(),o("div",V,[c("div",B,[c("div",{class:"bg-blue-600 h-2 rounded-full transition-all duration-100",style:w({width:x(je)+"%"})},null,4)]),c("p",G," æ­£åœ¨æŠ½å– "+m(ve.value)+" åç²çè€…... ",1)])):g("",!0)]),Qe.value?(P(),o("div",H,[t[5]||(t[5]=c("h3",{class:"text-lg font-semibold text-gray-900 mb-2"},"ç•¶å‰çå“",-1)),c("div",J,m(Qe.value.title),1),c("p",K,m(Qe.value.description),1),c("div",L,[c("div",O," å‰©é¤˜çå“: "+m(Qe.value.remainingQuantity)+" / "+m(Qe.value.quantity),1),c("div",R," æœ¬æ¬¡æŠ½å–: "+m(Math.min(ve.value,Qe.value.remainingQuantity))+" å ",1)]),ve.value>Qe.value.remainingQuantity?(P(),o("div",X," âš ï¸ æŠ½å–äººæ•¸è¶…éå‰©é¤˜çå“æ•¸é‡ï¼Œå°‡èª¿æ•´ç‚º "+m(Qe.value.remainingQuantity)+" å ",1)):g("",!0)])):g("",!0),1===ue.value.length?(P(),o("div",Y,[t[6]||(t[6]=c("div",{class:"text-6xl mb-4"},"ğŸ‰",-1)),t[7]||(t[7]=c("h3",{class:"text-3xl font-bold text-gray-900 mb-4"},"æ­å–œï¼",-1)),c("div",Z,m(ue.value[0].name),1),ue.value[0].position?(P(),o("div",$,m(ue.value[0].position),1)):g("",!0),c("div",ee,"ç²ç: "+m(ue.value[0].prizeWon),1),c("div",{class:"mt-6 flex justify-center gap-4"},[c("button",{onClick:Ee,class:"btn-primary"},"ç¢ºèªç²çè€…"),c("button",{onClick:Fe,class:"btn-secondary"},"é‡æ–°æŠ½ç")])])):ue.value.length>1?(P(),o("div",te,[t[9]||(t[9]=c("div",{class:"text-center"},[c("div",{class:"text-6xl mb-4"},"ğŸ‰"),c("h3",{class:"text-3xl font-bold text-gray-900 mb-6"},"æ­å–œæ‰€æœ‰ç²çè€…ï¼")],-1)),c("div",le,[(P(!0),o(f,null,h(ue.value,(e,l)=>(P(),o("div",{key:e.id,class:"bg-white p-4 rounded-lg border border-yellow-300 text-center"},[t[8]||(t[8]=c("div",{class:"text-2xl mb-2"},"ğŸ†",-1)),c("div",ae,m(e.name),1),e.position?(P(),o("div",se,m(e.position),1)):g("",!0),c("div",ie,m(e.prizeWon),1)]))),128))]),c("div",{class:"flex justify-center gap-4"},[c("button",{onClick:Ee,class:"btn-primary"},"ç¢ºèªæ‰€æœ‰ç²çè€…"),c("button",{onClick:Fe,class:"btn-secondary"},"é‡æ–°æŠ½ç")])])):g("",!0),c("div",ne,[(P(!0),o(f,null,h(x(me),e=>{var t;return P(),C(M,{key:e.id,participant:e,"is-drawing":x(Pe),"is-selected":(null==(t=x(be))?void 0:t.id)===e.id||ue.value.some(t=>t.id===e.id),onClick:t=>x(pe)(e.id)},null,8,["participant","is-drawing","is-selected","onClick"])}),128))]),0===x(me).length?(P(),o("div",re,[t[11]||(t[11]=c("div",{class:"text-6xl mb-4"},"ğŸ¯",-1)),t[12]||(t[12]=c("h3",{class:"text-xl font-semibold text-gray-900 mb-2"},"ç„¡å¯ç”¨åƒèˆ‡è€…",-1)),t[13]||(t[13]=c("p",{class:"text-gray-600 mb-4"},"æ–°å¢ä¸€äº›åƒèˆ‡è€…ä»¥é–‹å§‹å¹¸é‹æŠ½çï¼",-1)),d(l,{to:"/",class:"btn-primary"},{default:u(()=>[...t[10]||(t[10]=[k("æ–°å¢åƒèˆ‡è€…",-1)])]),_:1})])):g("",!0)])])}}});export{oe as default};
