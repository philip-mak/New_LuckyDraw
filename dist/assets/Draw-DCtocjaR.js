import{d as e,c as t,n as a,a as l,b as s,t as i,o as n,_ as r,u as o,e as c,r as d,s as u,f as g,w as p,g as x,h as m,i as v,j as b,k as y,l as f,v as h,F as w,m as k,p as C,q as D,x as j}from"./index-qEUCc70z.js";import{u as M}from"./settings-DEdqK-F6.js";const P={class:"text-center"},_={class:"w-12 h-12 bg-gradient-to-br from-blue-400 to-purple-500 rounded-full flex items-center justify-center mx-auto mb-3"},W={class:"text-white font-bold text-lg"},z={class:"font-semibold text-gray-900 text-sm mb-1 truncate"},A={key:0,class:"text-xs text-gray-600 truncate"},Q={key:1,class:"text-xs text-gray-500 truncate mt-1"},I={key:2,class:"mt-1"},S={key:3,class:"mt-2"},q=r(e({__name:"ParticipantCard",props:{participant:{},isSelected:{type:Boolean},isDrawing:{type:Boolean}},emits:["click"],setup:e=>(r,o)=>(n(),t("div",{class:a(["participant-card",{selected:e.isSelected&&!e.isDrawing,winner:e.participant.isWinner,"drawing-selected":e.isDrawing&&e.isSelected,"drawing-mode":e.isDrawing}]),onClick:o[0]||(o[0]=e=>r.$emit("click"))},[l("div",P,[l("div",_,[l("span",W,i(e.participant.name.charAt(0).toUpperCase()),1)]),l("h3",z,i(e.participant.name),1),e.participant.position?(n(),t("p",A,i(e.participant.position),1)):s("",!0),e.participant.group?(n(),t("p",Q,i(e.participant.group),1)):s("",!0),e.isDrawing&&e.isSelected?(n(),t("div",I,[...o[1]||(o[1]=[l("span",{class:"inline-flex items-center px-2 py-1 rounded-full text-xs font-bold bg-red-500 text-white animate-pulse"}," ğŸ¯ æ­£åœ¨æŠ½é¸ ",-1)])])):s("",!0),e.participant.isWinner?(n(),t("div",S,[...o[2]||(o[2]=[l("span",{class:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800"}," ğŸ† ç²çè€… ",-1)])])):s("",!0)])],2))}),[["__scopeId","data-v-44ccb3a6"]]),B={class:"min-h-screen christmas-bg"},U={class:"bg-white shadow-sm border-b border-gray-200"},E={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"},F={class:"flex justify-between items-center py-4"},N={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8"},T={class:"card p-6 mb-8"},V={class:"flex flex-col md:flex-row justify-between items-center gap-4"},$={class:"text-gray-600"},G={class:"flex flex-col sm:flex-row gap-3 items-center"},H={class:"flex items-center gap-2"},J=["disabled"],K=["value"],L={class:"flex gap-3"},O=["disabled"],R={key:0,class:"mt-4"},X={class:"w-full bg-gray-200 rounded-full h-2"},Y={class:"text-center text-sm text-gray-600 mt-2"},Z={key:0,class:"card p-6 mb-8 text-center"},ee={class:"text-2xl font-bold text-purple-600 mb-2"},te={class:"text-gray-600"},ae={class:"flex justify-center gap-4 mt-4"},le={class:"text-sm text-gray-500"},se={class:"text-sm text-blue-600"},ie={key:0,class:"text-sm text-orange-600 mt-2"},ne={key:1,class:"card p-8 mb-8 text-center bg-gradient-to-r from-yellow-50 to-orange-50 border-2 border-yellow-200"},re={class:"text-xl text-gray-700 mb-2"},oe={key:0,class:"text-lg text-gray-600 mb-4"},ce={class:"text-lg font-semibold text-purple-600"},de={key:2,class:"card p-8 mb-8 bg-gradient-to-r from-yellow-50 to-orange-50 border-2 border-yellow-200"},ue={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-6"},ge={class:"font-bold text-lg text-gray-900"},pe={key:0,class:"text-sm text-gray-600"},xe={class:"text-purple-600 font-medium mt-2"},me={class:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4"},ve={key:3,class:"text-center py-12"},be=e({__name:"Draw",setup(e){const r=o(),P=c(),_=M(),W=d([]),z=d(1),A=d([]),{activeParticipants:Q,winners:I,selectedParticipant:S}=u(r),{selectParticipant:be,markAsWinner:ye,clearSelection:fe,resetAllWinners:he}=r,{getNextAvailablePrize:we,consumePrize:ke}=P,{settings:Ce,isDrawing:De,drawProgress:je,startDrawing:Me,stopDrawing:Pe,updateDrawProgress:_e}=_,We=g(()=>we()),ze=g(()=>{const e=Math.min(Q.value.length,20);return Array.from({length:e},(e,t)=>t+1)});let Ae=null;const Qe=()=>{if(0===Q.value.length||0===z.value)return;Me(),W.value=[],A.value=[],fe();let e=0;const t=50/Ce.animationDuration*100;Ae=setInterval(()=>{if(e+=t,_e(e),e<90){fe();const e=Math.floor(Math.random()*Q.value.length),t=Q.value[e];be(t.id)}e>=100&&Se()},50)},Ie=()=>{Ae&&(clearInterval(Ae),Ae=null),Pe(),W.value=[]},Se=()=>{Ae&&(clearInterval(Ae),Ae=null),Pe(),fe();const e=[...Q.value],t=[],a=We.value?Math.min(z.value,We.value.remainingQuantity,e.length):Math.min(z.value,e.length);for(let l=0;l<a;l++){const a=Math.floor(Math.random()*e.length),l=e.splice(a,1)[0];We.value&&t.push({...l,prizeWon:We.value.title})}W.value=t},qe=()=>{if(W.value.length>0&&We.value){W.value.forEach((e,t)=>{ye(e.id,e.prizeWon)});for(let e=0;e<W.value.length;e++)We.value.remainingQuantity>0&&ke(We.value.id);W.value=[],fe()}},Be=()=>{W.value=[],fe(),Q.value.length>0&&setTimeout(()=>Qe(),500)},Ue=()=>{confirm("æ‚¨ç¢ºå®šè¦é‡è¨­æ‰€æœ‰ç²çè€…å—ï¼Ÿæ­¤æ“ä½œç„¡æ³•å¾©åŸã€‚")&&(he(),P.resetAllPrizes(),W.value=[],fe())};return p(()=>Q.value.length,e=>{z.value>e&&(z.value=Math.max(1,e))}),x(()=>{Ae&&clearInterval(Ae),Q.value.length>0&&(z.value=1)}),(e,r)=>{const o=b("router-link");return n(),t("div",B,[l("header",U,[l("div",E,[l("div",F,[r[2]||(r[2]=l("h1",{class:"text-2xl font-bold text-gray-900"},"ğŸ¯ å¹¸é‹æŠ½ç",-1)),m(o,{to:"/",class:"btn-secondary"},{default:v(()=>[...r[1]||(r[1]=[D("â† è¿”å›é¦–é ",-1)])]),_:1})])])]),l("main",N,[l("div",T,[l("div",V,[l("div",null,[r[3]||(r[3]=l("h2",{class:"text-xl font-semibold text-gray-900"},"æº–å‚™æŠ½çï¼Ÿ",-1)),l("p",$,"å‰©é¤˜ "+i(y(Q).length)+" ååƒèˆ‡è€…",1)]),l("div",G,[l("div",H,[r[4]||(r[4]=l("label",{class:"text-sm font-medium text-gray-700 whitespace-nowrap"},"æŠ½å–äººæ•¸:",-1)),f(l("select",{"onUpdate:modelValue":r[0]||(r[0]=e=>z.value=e),disabled:y(De),class:a(["p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm",{"opacity-50 cursor-not-allowed":y(De)}])},[(n(!0),t(w,null,k(ze.value,e=>(n(),t("option",{key:e,value:e},i(e)+" å ",9,K))),128))],10,J),[[h,z.value]])]),l("div",L,[y(De)?(n(),t("button",{key:1,onClick:Ie,class:"btn-danger px-8 py-3 text-lg font-semibold"}," â¹ï¸ åœæ­¢æŠ½ç ")):(n(),t("button",{key:0,onClick:Qe,disabled:0===y(Q).length||0===z.value,class:a(["btn-primary px-8 py-3 text-lg font-semibold",{"opacity-50 cursor-not-allowed":0===y(Q).length||0===z.value}])}," ğŸ² æŠ½å– "+i(z.value)+" å ",11,O)),y(I).length>0?(n(),t("button",{key:2,onClick:Ue,class:"btn-secondary"}," ğŸ”„ é‡è¨­æ‰€æœ‰ ")):s("",!0)])])]),y(De)?(n(),t("div",R,[l("div",X,[l("div",{class:"bg-blue-600 h-2 rounded-full transition-all duration-100",style:C({width:y(je)+"%"})},null,4)]),l("p",Y," æ­£åœ¨æŠ½å– "+i(z.value)+" åç²çè€…... ",1)])):s("",!0)]),We.value?(n(),t("div",Z,[r[5]||(r[5]=l("h3",{class:"text-lg font-semibold text-gray-900 mb-2"},"ç•¶å‰çå“",-1)),l("div",ee,i(We.value.title),1),l("p",te,i(We.value.description),1),l("div",ae,[l("div",le," å‰©é¤˜çå“: "+i(We.value.remainingQuantity)+" / "+i(We.value.quantity),1),l("div",se," æœ¬æ¬¡æŠ½å–: "+i(Math.min(z.value,We.value.remainingQuantity))+" å ",1)]),z.value>We.value.remainingQuantity?(n(),t("div",ie," âš ï¸ æŠ½å–äººæ•¸è¶…éå‰©é¤˜çå“æ•¸é‡ï¼Œå°‡èª¿æ•´ç‚º "+i(We.value.remainingQuantity)+" å ",1)):s("",!0)])):s("",!0),1===W.value.length?(n(),t("div",ne,[r[6]||(r[6]=l("div",{class:"text-6xl mb-4"},"ğŸ‰",-1)),r[7]||(r[7]=l("h3",{class:"text-3xl font-bold text-gray-900 mb-4"},"æ­å–œï¼",-1)),l("div",re,i(W.value[0].name),1),W.value[0].position?(n(),t("div",oe,i(W.value[0].position),1)):s("",!0),l("div",ce,"ç²ç: "+i(W.value[0].prizeWon),1),l("div",{class:"mt-6 flex justify-center gap-4"},[l("button",{onClick:qe,class:"btn-primary"},"ç¢ºèªç²çè€…"),l("button",{onClick:Be,class:"btn-secondary"},"é‡æ–°æŠ½ç")])])):W.value.length>1?(n(),t("div",de,[r[9]||(r[9]=l("div",{class:"text-center"},[l("div",{class:"text-6xl mb-4"},"ğŸ‰"),l("h3",{class:"text-3xl font-bold text-gray-900 mb-6"},"æ­å–œæ‰€æœ‰ç²çè€…ï¼")],-1)),l("div",ue,[(n(!0),t(w,null,k(W.value,(e,a)=>(n(),t("div",{key:e.id,class:"bg-white p-4 rounded-lg border border-yellow-300 text-center"},[r[8]||(r[8]=l("div",{class:"text-2xl mb-2"},"ğŸ†",-1)),l("div",ge,i(e.name),1),e.position?(n(),t("div",pe,i(e.position),1)):s("",!0),l("div",xe,i(e.prizeWon),1)]))),128))]),l("div",{class:"flex justify-center gap-4"},[l("button",{onClick:qe,class:"btn-primary"},"ç¢ºèªæ‰€æœ‰ç²çè€…"),l("button",{onClick:Be,class:"btn-secondary"},"é‡æ–°æŠ½ç")])])):s("",!0),l("div",me,[(n(!0),t(w,null,k(y(Q),e=>{var t;return n(),j(q,{key:e.id,participant:e,"is-drawing":y(De),"is-selected":(null==(t=y(S))?void 0:t.id)===e.id||W.value.some(t=>t.id===e.id),onClick:t=>y(be)(e.id)},null,8,["participant","is-drawing","is-selected","onClick"])}),128))]),0===y(Q).length?(n(),t("div",ve,[r[11]||(r[11]=l("div",{class:"text-6xl mb-4"},"ğŸ¯",-1)),r[12]||(r[12]=l("h3",{class:"text-xl font-semibold text-gray-900 mb-2"},"ç„¡å¯ç”¨åƒèˆ‡è€…",-1)),r[13]||(r[13]=l("p",{class:"text-gray-600 mb-4"},"æ–°å¢ä¸€äº›åƒèˆ‡è€…ä»¥é–‹å§‹å¹¸é‹æŠ½çï¼",-1)),m(o,{to:"/",class:"btn-primary"},{default:v(()=>[...r[10]||(r[10]=[D("æ–°å¢åƒèˆ‡è€…",-1)])]),_:1})])):s("",!0)])])}}});export{be as default};
