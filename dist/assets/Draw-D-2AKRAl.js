import{d as e,u as t,a as l,b as a,c as s,r as i,s as n,w as r,o,e as c,f as u,g as d,h as v,i as m,n as g,t as x,j as p,k as b,l as y,m as f,v as h,p as w,F as k,q as j,x as C,y as P}from"./index-ZpqbGPxJ.js";import{u as M}from"./settings-B7Nrhd6H.js";import{P as z}from"./ParticipantCard-D-F4dCni.js";const D={class:"min-h-screen christmas-bg"},Q={class:"bg-white shadow-sm border-b border-gray-200"},W={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"},A={class:"flex justify-between items-center py-4"},I={key:0,class:"text-sm text-gray-600 mt-1"},_={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8"},q={class:"card p-6 mb-8"},S={class:"flex flex-col md:flex-row justify-between items-center gap-4"},E={class:"text-gray-600"},F={class:"flex flex-col sm:flex-row gap-3 items-center"},N={class:"flex items-center gap-2"},T=["disabled"],U=["value"],V={class:"flex gap-3"},B=["disabled"],G={key:0,class:"mt-4"},H={class:"w-full bg-gray-200 rounded-full h-2"},J={class:"text-center text-sm text-gray-600 mt-2"},K={key:0,class:"card p-6 mb-8 text-center"},L={class:"text-2xl font-bold text-purple-600 mb-2"},O={class:"text-gray-600"},R={class:"flex justify-center gap-4 mt-4"},X={class:"text-sm text-gray-500"},Y={class:"text-sm text-blue-600"},Z={key:0,class:"text-sm text-orange-600 mt-2"},$={key:1,class:"card p-8 mb-8 text-center bg-gradient-to-r from-yellow-50 to-orange-50 border-2 border-yellow-200"},ee={class:"flex justify-center mb-6"},te={class:"w-64"},le={class:"text-lg font-semibold text-purple-600 mb-4"},ae={key:2,class:"card p-8 mb-8 bg-gradient-to-r from-yellow-50 to-orange-50 border-2 border-yellow-200"},se={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 mb-6"},ie={class:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4"},ne={key:3,class:"text-center py-12"},re=e({__name:"Draw",setup(e){const re=t(),oe=l(),ce=a(),ue=M(),de=s(()=>ce.activeSession),ve=i([]),me=i(1),ge=i([]),{activeParticipants:xe,winners:pe,selectedParticipant:be}=n(re),{selectParticipant:ye,markAsWinner:fe,clearSelection:he,resetAllWinners:we}=re,{getNextAvailablePrize:ke,consumePrize:je}=oe,{settings:Ce,isDrawing:Pe,drawProgress:Me,startDrawing:ze,stopDrawing:De,updateDrawProgress:Qe}=ue,We=s(()=>ke()),Ae=s(()=>{const e=Math.min(xe.value.length,20);return Array.from({length:e},(e,t)=>t+1)});let Ie=null;const _e=()=>{if(0===xe.value.length||0===me.value)return;ze(),ve.value=[],ge.value=[],he();let e=0;const t=50/Ce.animationDuration*100;Ie=setInterval(()=>{if(e+=t,Qe(e),e<90){he();const e=Math.floor(Math.random()*xe.value.length),t=xe.value[e];ye(t.id)}e>=100&&Se()},50)},qe=()=>{Ie&&(clearInterval(Ie),Ie=null),De(),ve.value=[]},Se=()=>{Ie&&(clearInterval(Ie),Ie=null),De(),he();const e=[...xe.value],t=[],l=We.value?Math.min(me.value,We.value.remainingQuantity,e.length):Math.min(me.value,e.length);for(let a=0;a<l;a++){const l=Math.floor(Math.random()*e.length),a=e.splice(l,1)[0];We.value&&t.push({...a,prizeWon:We.value.title,isWinner:!0})}ve.value=t},Ee=()=>{if(ve.value.length>0&&We.value){ve.value.forEach((e,t)=>{fe(e.id,e.prizeWon)});for(let e=0;e<ve.value.length;e++)We.value.remainingQuantity>0&&je(We.value.id);ve.value=[],he()}},Fe=()=>{ve.value=[],he(),xe.value.length>0&&setTimeout(()=>_e(),500)},Ne=()=>{confirm("æ‚¨ç¢ºå®šè¦é‡è¨­æ‰€æœ‰ç²çè€…å—ï¼Ÿæ­¤æ“ä½œç„¡æ³•å¾©åŸã€‚")&&(we(),oe.resetAllPrizes(),ve.value=[],he())};return r(()=>xe.value.length,e=>{me.value>e&&(me.value=Math.max(1,e))}),o(()=>{Ie&&clearInterval(Ie),xe.value.length>0&&(me.value=1)}),(e,t)=>{const l=b("router-link");return P(),c("div",D,[u("header",Q,[u("div",W,[u("div",A,[u("div",null,[t[2]||(t[2]=u("h1",{class:"text-2xl font-bold text-gray-900"},"ğŸ¯ å¹¸é‹æŠ½ç",-1)),de.value?(P(),c("p",I,[t[1]||(t[1]=m(" å ´æ¬¡: ",-1)),u("span",{class:"font-medium",style:g({color:de.value.color})},x(de.value.name),5)])):v("",!0)]),d(l,{to:"/",class:"btn-secondary"},{default:p(()=>[...t[3]||(t[3]=[m("â† è¿”å›é¦–é ",-1)])]),_:1})])])]),u("main",_,[u("div",q,[u("div",S,[u("div",null,[t[4]||(t[4]=u("h2",{class:"text-xl font-semibold text-gray-900"},"æº–å‚™æŠ½çï¼Ÿ",-1)),u("p",E,"å‰©é¤˜ "+x(y(xe).length)+" ååƒèˆ‡è€…",1)]),u("div",F,[u("div",N,[t[5]||(t[5]=u("label",{class:"text-sm font-medium text-gray-700 whitespace-nowrap"},"æŠ½å–äººæ•¸:",-1)),f(u("select",{"onUpdate:modelValue":t[0]||(t[0]=e=>me.value=e),disabled:y(Pe),class:w(["p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm",{"opacity-50 cursor-not-allowed":y(Pe)}])},[(P(!0),c(k,null,j(Ae.value,e=>(P(),c("option",{key:e,value:e},x(e)+" å ",9,U))),128))],10,T),[[h,me.value]])]),u("div",V,[y(Pe)?(P(),c("button",{key:1,onClick:qe,class:"btn-danger px-8 py-3 text-lg font-semibold"}," â¹ï¸ åœæ­¢æŠ½ç ")):(P(),c("button",{key:0,onClick:_e,disabled:0===y(xe).length||0===me.value,class:w(["btn-primary px-8 py-3 text-lg font-semibold",{"opacity-50 cursor-not-allowed":0===y(xe).length||0===me.value}])}," ğŸ² æŠ½å– "+x(me.value)+" å ",11,B)),y(pe).length>0?(P(),c("button",{key:2,onClick:Ne,class:"btn-secondary"}," ğŸ”„ é‡è¨­æ‰€æœ‰ ")):v("",!0)])])]),y(Pe)?(P(),c("div",G,[u("div",H,[u("div",{class:"bg-blue-600 h-2 rounded-full transition-all duration-100",style:g({width:y(Me)+"%"})},null,4)]),u("p",J," æ­£åœ¨æŠ½å– "+x(me.value)+" åç²çè€…... ",1)])):v("",!0)]),We.value?(P(),c("div",K,[t[6]||(t[6]=u("h3",{class:"text-lg font-semibold text-gray-900 mb-2"},"ç•¶å‰çå“",-1)),u("div",L,x(We.value.title),1),u("p",O,x(We.value.description),1),u("div",R,[u("div",X," å‰©é¤˜çå“: "+x(We.value.remainingQuantity)+" / "+x(We.value.quantity),1),u("div",Y," æœ¬æ¬¡æŠ½å–: "+x(Math.min(me.value,We.value.remainingQuantity))+" å ",1)]),me.value>We.value.remainingQuantity?(P(),c("div",Z," âš ï¸ æŠ½å–äººæ•¸è¶…éå‰©é¤˜çå“æ•¸é‡ï¼Œå°‡èª¿æ•´ç‚º "+x(We.value.remainingQuantity)+" å ",1)):v("",!0)])):v("",!0),1===ve.value.length?(P(),c("div",$,[t[7]||(t[7]=u("div",{class:"text-6xl mb-4"},"ğŸ‰",-1)),t[8]||(t[8]=u("h3",{class:"text-3xl font-bold text-gray-900 mb-4"},"æ­å–œï¼",-1)),u("div",ee,[u("div",te,[d(z,{participant:ve.value[0]},null,8,["participant"])])]),u("div",le,"ç²ç: "+x(ve.value[0].prizeWon),1),u("div",{class:"mt-6 flex justify-center gap-4"},[u("button",{onClick:Ee,class:"btn-primary"},"ç¢ºèªç²çè€…"),u("button",{onClick:Fe,class:"btn-secondary"},"é‡æ–°æŠ½ç")])])):ve.value.length>1?(P(),c("div",ae,[t[9]||(t[9]=u("div",{class:"text-center"},[u("div",{class:"text-6xl mb-4"},"ğŸ‰"),u("h3",{class:"text-3xl font-bold text-gray-900 mb-6"},"æ­å–œæ‰€æœ‰ç²çè€…ï¼")],-1)),u("div",se,[(P(!0),c(k,null,j(ve.value,e=>(P(),C(z,{key:e.id,participant:e},null,8,["participant"]))),128))]),u("div",{class:"flex justify-center gap-4"},[u("button",{onClick:Ee,class:"btn-primary"},"ç¢ºèªæ‰€æœ‰ç²çè€…"),u("button",{onClick:Fe,class:"btn-secondary"},"é‡æ–°æŠ½ç")])])):v("",!0),u("div",ie,[(P(!0),c(k,null,j(y(xe),e=>{var t;return P(),C(z,{key:e.id,participant:e,"is-drawing":y(Pe),"is-selected":(null==(t=y(be))?void 0:t.id)===e.id||ve.value.some(t=>t.id===e.id),onClick:t=>y(ye)(e.id)},null,8,["participant","is-drawing","is-selected","onClick"])}),128))]),0===y(xe).length?(P(),c("div",ne,[t[11]||(t[11]=u("div",{class:"text-6xl mb-4"},"ğŸ¯",-1)),t[12]||(t[12]=u("h3",{class:"text-xl font-semibold text-gray-900 mb-2"},"ç„¡å¯ç”¨åƒèˆ‡è€…",-1)),t[13]||(t[13]=u("p",{class:"text-gray-600 mb-4"},"æ–°å¢ä¸€äº›åƒèˆ‡è€…ä»¥é–‹å§‹å¹¸é‹æŠ½çï¼",-1)),d(l,{to:"/",class:"btn-primary"},{default:p(()=>[...t[10]||(t[10]=[m("æ–°å¢åƒèˆ‡è€…",-1)])]),_:1})])):v("",!0)])])}}});export{re as default};
