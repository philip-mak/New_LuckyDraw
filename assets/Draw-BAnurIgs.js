import{d as e,r as t,w as a,c as l,n as s,a as i,b as n,t as r,e as o,o as c,_ as d,u,f as g,s as m,g as p,h as x,i as v,j as b,k as y,l as f,m as h,v as w,F as k,p as D,q as C,x as j,y as M}from"./index-DvYaeYcm.js";import{u as P}from"./settings-Cc42vpbS.js";const S={class:"text-center"},_={class:"w-12 h-12 bg-gradient-to-br from-blue-400 to-purple-500 rounded-full flex items-center justify-center mx-auto mb-3"},W={class:"text-white font-bold text-lg"},z={class:"font-semibold text-gray-900 text-sm mb-1 truncate"},A={key:0,class:"text-xs text-gray-600 truncate"},Q={key:1,class:"text-xs text-gray-500 truncate mt-1"},I={key:2,class:"mt-1"},T={class:"mt-2 space-y-1"},N={class:"text-xs text-gray-500 text-center"},$={key:3,class:"mt-2"},Y=d(e({__name:"ParticipantCard",props:{participant:{},isSelected:{type:Boolean},isDrawing:{type:Boolean}},emits:["click","testAnimation"],setup(e,{emit:d}){const u=e,g=t(!1),m=()=>{console.log("ğŸ§ª Testing animation for:",u.participant.name),g.value=!0,setTimeout(()=>{g.value=!1,console.log("ğŸ§ª Test animation complete")},3e3)};return a([()=>u.isDrawing,()=>u.isSelected],([e,t],[a,l])=>{e===a&&t===l||console.log(`ğŸ­ ${u.participant.name}: Drawing=${e}, Selected=${t}`)},{immediate:!0}),(t,a)=>(c(),l("div",{class:s(["participant-card",{selected:e.isSelected&&!e.isDrawing,winner:e.participant.isWinner,"drawing-selected":e.isDrawing&&e.isSelected||g.value,"drawing-mode":e.isDrawing,"test-animating":g.value}]),onClick:a[0]||(a[0]=e=>t.$emit("click"))},[i("div",S,[i("div",_,[i("span",W,r(e.participant.name.charAt(0).toUpperCase()),1)]),i("h3",z,r(e.participant.name),1),e.participant.position?(c(),l("p",A,r(e.participant.position),1)):n("",!0),e.participant.group?(c(),l("p",Q,r(e.participant.group),1)):n("",!0),e.isDrawing&&e.isSelected?(c(),l("div",I,[...a[1]||(a[1]=[i("span",{class:"inline-flex items-center px-2 py-1 rounded-full text-xs font-bold bg-red-500 text-white animate-pulse"}," ğŸ¯ æ­£åœ¨æŠ½é¸ ",-1)])])):n("",!0),i("div",T,[i("button",{onClick:o(m,["stop"]),class:s(["w-full text-xs px-2 py-1 bg-blue-500 text-white rounded hover:bg-blue-600 font-bold",{"bg-red-500":g.value}])},r(g.value?"ğŸŒˆ å‹•ç•«ä¸­...":"ğŸ§ª æ¸¬è©¦å‹•ç•«"),3),i("div",N," D:"+r(e.isDrawing?"Y":"N")+" | S:"+r(e.isSelected?"Y":"N")+" | T:"+r(g.value?"Y":"N"),1)]),e.participant.isWinner?(c(),l("div",$,[...a[2]||(a[2]=[i("span",{class:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800"}," ğŸ† ç²çè€… ",-1)])])):n("",!0)])],2))}}),[["__scopeId","data-v-46490bd5"]]),q={class:"min-h-screen christmas-bg"},B={class:"bg-white shadow-sm border-b border-gray-200"},U={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"},E={class:"flex justify-between items-center py-4"},F={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8"},V={class:"card p-6 mb-8"},G={class:"flex flex-col md:flex-row justify-between items-center gap-4"},H={class:"text-gray-600"},J={class:"flex flex-col sm:flex-row gap-3 items-center"},K={class:"flex items-center gap-2"},L=["disabled"],O=["value"],R={class:"flex gap-3"},X=["disabled"],Z={key:0,class:"mt-4"},ee={class:"w-full bg-gray-200 rounded-full h-2"},te={class:"text-center text-sm text-gray-600 mt-2"},ae={key:0,class:"card p-6 mb-8 text-center"},le={class:"text-2xl font-bold text-purple-600 mb-2"},se={class:"text-gray-600"},ie={class:"flex justify-center gap-4 mt-4"},ne={class:"text-sm text-gray-500"},re={class:"text-sm text-blue-600"},oe={key:0,class:"text-sm text-orange-600 mt-2"},ce={key:1,class:"card p-8 mb-8 text-center bg-gradient-to-r from-yellow-50 to-orange-50 border-2 border-yellow-200"},de={class:"text-xl text-gray-700 mb-2"},ue={key:0,class:"text-lg text-gray-600 mb-4"},ge={class:"text-lg font-semibold text-purple-600"},me={key:2,class:"card p-8 mb-8 bg-gradient-to-r from-yellow-50 to-orange-50 border-2 border-yellow-200"},pe={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-6"},xe={class:"font-bold text-lg text-gray-900"},ve={key:0,class:"text-sm text-gray-600"},be={class:"text-purple-600 font-medium mt-2"},ye={class:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4"},fe={key:3,class:"text-center py-12"},he=e({__name:"Draw",setup(e){const o=u(),d=g(),S=P(),_=t([]),W=t(1),z=t([]),{activeParticipants:A,winners:Q,selectedParticipant:I}=m(o),{selectParticipant:T,markAsWinner:N,clearSelection:$,resetAllWinners:he}=o,{getNextAvailablePrize:we,consumePrize:ke}=d,{settings:De,isDrawing:Ce,drawProgress:je,startDrawing:Me,stopDrawing:Pe,updateDrawProgress:Se}=S,_e=p(()=>we()),We=p(()=>{const e=Math.min(A.value.length,20);return Array.from({length:e},(e,t)=>t+1)});let ze=null;const Ae=()=>{if(0===A.value.length||0===W.value)return;Me(),_.value=[],z.value=[],$();let e=0;const t=50/De.animationDuration*100;ze=setInterval(()=>{if(e+=t,Se(e),e<90){$();const e=Math.floor(Math.random()*A.value.length),t=A.value[e];T(t.id)}e>=100&&Ie()},50)},Qe=()=>{ze&&(clearInterval(ze),ze=null),Pe(),_.value=[]},Ie=()=>{ze&&(clearInterval(ze),ze=null),Pe(),$();const e=[...A.value],t=[],a=_e.value?Math.min(W.value,_e.value.remainingQuantity,e.length):Math.min(W.value,e.length);for(let l=0;l<a;l++){const a=Math.floor(Math.random()*e.length),l=e.splice(a,1)[0];_e.value&&t.push({...l,prizeWon:_e.value.title})}_.value=t},Te=()=>{if(_.value.length>0&&_e.value){_.value.forEach((e,t)=>{N(e.id,e.prizeWon)});for(let e=0;e<_.value.length;e++)_e.value.remainingQuantity>0&&ke(_e.value.id);_.value=[],$()}},Ne=()=>{_.value=[],$(),A.value.length>0&&setTimeout(()=>Ae(),500)},$e=()=>{confirm("æ‚¨ç¢ºå®šè¦é‡è¨­æ‰€æœ‰ç²çè€…å—ï¼Ÿæ­¤æ“ä½œç„¡æ³•å¾©åŸã€‚")&&(he(),d.resetAllPrizes(),_.value=[],$())};return a(()=>A.value.length,e=>{W.value>e&&(W.value=Math.max(1,e))}),x(()=>{ze&&clearInterval(ze),A.value.length>0&&(W.value=1)}),(e,t)=>{const a=y("router-link");return c(),l("div",q,[i("header",B,[i("div",U,[i("div",E,[t[2]||(t[2]=i("h1",{class:"text-2xl font-bold text-gray-900"},"ğŸ¯ å¹¸é‹æŠ½ç",-1)),v(a,{to:"/",class:"btn-secondary"},{default:b(()=>[...t[1]||(t[1]=[j("â† è¿”å›é¦–é ",-1)])]),_:1})])])]),i("main",F,[i("div",V,[i("div",G,[i("div",null,[t[3]||(t[3]=i("h2",{class:"text-xl font-semibold text-gray-900"},"æº–å‚™æŠ½çï¼Ÿ",-1)),i("p",H,"å‰©é¤˜ "+r(f(A).length)+" ååƒèˆ‡è€…",1)]),i("div",J,[i("div",K,[t[4]||(t[4]=i("label",{class:"text-sm font-medium text-gray-700 whitespace-nowrap"},"æŠ½å–äººæ•¸:",-1)),h(i("select",{"onUpdate:modelValue":t[0]||(t[0]=e=>W.value=e),disabled:f(Ce),class:s(["p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm",{"opacity-50 cursor-not-allowed":f(Ce)}])},[(c(!0),l(k,null,D(We.value,e=>(c(),l("option",{key:e,value:e},r(e)+" å ",9,O))),128))],10,L),[[w,W.value]])]),i("div",R,[f(Ce)?(c(),l("button",{key:1,onClick:Qe,class:"btn-danger px-8 py-3 text-lg font-semibold"}," â¹ï¸ åœæ­¢æŠ½ç ")):(c(),l("button",{key:0,onClick:Ae,disabled:0===f(A).length||0===W.value,class:s(["btn-primary px-8 py-3 text-lg font-semibold",{"opacity-50 cursor-not-allowed":0===f(A).length||0===W.value}])}," ğŸ² æŠ½å– "+r(W.value)+" å ",11,X)),f(Q).length>0?(c(),l("button",{key:2,onClick:$e,class:"btn-secondary"}," ğŸ”„ é‡è¨­æ‰€æœ‰ ")):n("",!0)])])]),f(Ce)?(c(),l("div",Z,[i("div",ee,[i("div",{class:"bg-blue-600 h-2 rounded-full transition-all duration-100",style:C({width:f(je)+"%"})},null,4)]),i("p",te," æ­£åœ¨æŠ½å– "+r(W.value)+" åç²çè€…... ",1)])):n("",!0)]),_e.value?(c(),l("div",ae,[t[5]||(t[5]=i("h3",{class:"text-lg font-semibold text-gray-900 mb-2"},"ç•¶å‰çå“",-1)),i("div",le,r(_e.value.title),1),i("p",se,r(_e.value.description),1),i("div",ie,[i("div",ne," å‰©é¤˜çå“: "+r(_e.value.remainingQuantity)+" / "+r(_e.value.quantity),1),i("div",re," æœ¬æ¬¡æŠ½å–: "+r(Math.min(W.value,_e.value.remainingQuantity))+" å ",1)]),W.value>_e.value.remainingQuantity?(c(),l("div",oe," âš ï¸ æŠ½å–äººæ•¸è¶…éå‰©é¤˜çå“æ•¸é‡ï¼Œå°‡èª¿æ•´ç‚º "+r(_e.value.remainingQuantity)+" å ",1)):n("",!0)])):n("",!0),1===_.value.length?(c(),l("div",ce,[t[6]||(t[6]=i("div",{class:"text-6xl mb-4"},"ğŸ‰",-1)),t[7]||(t[7]=i("h3",{class:"text-3xl font-bold text-gray-900 mb-4"},"æ­å–œï¼",-1)),i("div",de,r(_.value[0].name),1),_.value[0].position?(c(),l("div",ue,r(_.value[0].position),1)):n("",!0),i("div",ge,"ç²ç: "+r(_.value[0].prizeWon),1),i("div",{class:"mt-6 flex justify-center gap-4"},[i("button",{onClick:Te,class:"btn-primary"},"ç¢ºèªç²çè€…"),i("button",{onClick:Ne,class:"btn-secondary"},"é‡æ–°æŠ½ç")])])):_.value.length>1?(c(),l("div",me,[t[9]||(t[9]=i("div",{class:"text-center"},[i("div",{class:"text-6xl mb-4"},"ğŸ‰"),i("h3",{class:"text-3xl font-bold text-gray-900 mb-6"},"æ­å–œæ‰€æœ‰ç²çè€…ï¼")],-1)),i("div",pe,[(c(!0),l(k,null,D(_.value,(e,a)=>(c(),l("div",{key:e.id,class:"bg-white p-4 rounded-lg border border-yellow-300 text-center"},[t[8]||(t[8]=i("div",{class:"text-2xl mb-2"},"ğŸ†",-1)),i("div",xe,r(e.name),1),e.position?(c(),l("div",ve,r(e.position),1)):n("",!0),i("div",be,r(e.prizeWon),1)]))),128))]),i("div",{class:"flex justify-center gap-4"},[i("button",{onClick:Te,class:"btn-primary"},"ç¢ºèªæ‰€æœ‰ç²çè€…"),i("button",{onClick:Ne,class:"btn-secondary"},"é‡æ–°æŠ½ç")])])):n("",!0),i("div",ye,[(c(!0),l(k,null,D(f(A),e=>{var t;return c(),M(Y,{key:e.id,participant:e,"is-drawing":f(Ce),"is-selected":(null==(t=f(I))?void 0:t.id)===e.id||_.value.some(t=>t.id===e.id),onClick:t=>f(T)(e.id)},null,8,["participant","is-drawing","is-selected","onClick"])}),128))]),0===f(A).length?(c(),l("div",fe,[t[11]||(t[11]=i("div",{class:"text-6xl mb-4"},"ğŸ¯",-1)),t[12]||(t[12]=i("h3",{class:"text-xl font-semibold text-gray-900 mb-2"},"ç„¡å¯ç”¨åƒèˆ‡è€…",-1)),t[13]||(t[13]=i("p",{class:"text-gray-600 mb-4"},"æ–°å¢ä¸€äº›åƒèˆ‡è€…ä»¥é–‹å§‹å¹¸é‹æŠ½çï¼",-1)),v(a,{to:"/",class:"btn-primary"},{default:b(()=>[...t[10]||(t[10]=[j("æ–°å¢åƒèˆ‡è€…",-1)])]),_:1})])):n("",!0)])])}}});export{he as default};
