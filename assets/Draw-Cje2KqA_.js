import{d as e,u as t,a as l,r as a,s,c as i,w as n,o as r,b as o,e as c,f as d,g as u,h as v,i as g,t as m,j as x,k as p,v as b,n as y,F as f,l as h,m as w,p as k,q as j,x as C}from"./index-CZOYNy8x.js";import{u as P}from"./settings-DrRiY2FL.js";import{P as M}from"./ParticipantCard-CL4xkVGe.js";const z={class:"min-h-screen christmas-bg"},D={class:"bg-white shadow-sm border-b border-gray-200"},Q={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"},W={class:"flex justify-between items-center py-4"},A={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8"},I={class:"card p-6 mb-8"},_={class:"flex flex-col md:flex-row justify-between items-center gap-4"},q={class:"text-gray-600"},E={class:"flex flex-col sm:flex-row gap-3 items-center"},F={class:"flex items-center gap-2"},N=["disabled"],S=["value"],T={class:"flex gap-3"},U=["disabled"],V={key:0,class:"mt-4"},B={class:"w-full bg-gray-200 rounded-full h-2"},G={class:"text-center text-sm text-gray-600 mt-2"},H={key:0,class:"card p-6 mb-8 text-center"},J={class:"text-2xl font-bold text-purple-600 mb-2"},K={class:"text-gray-600"},L={class:"flex justify-center gap-4 mt-4"},O={class:"text-sm text-gray-500"},R={class:"text-sm text-blue-600"},X={key:0,class:"text-sm text-orange-600 mt-2"},Y={key:1,class:"card p-8 mb-8 text-center bg-gradient-to-r from-yellow-50 to-orange-50 border-2 border-yellow-200"},Z={class:"flex justify-center mb-6"},$={class:"w-64"},ee={class:"text-lg font-semibold text-purple-600 mb-4"},te={key:2,class:"card p-8 mb-8 bg-gradient-to-r from-yellow-50 to-orange-50 border-2 border-yellow-200"},le={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 mb-6"},ae={class:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4"},se={key:3,class:"text-center py-12"},ie=e({__name:"Draw",setup(e){const ie=t(),ne=l(),re=P(),oe=a([]),ce=a(1),de=a([]),{activeParticipants:ue,winners:ve,selectedParticipant:ge}=s(ie),{selectParticipant:me,markAsWinner:xe,clearSelection:pe,resetAllWinners:be}=ie,{getNextAvailablePrize:ye,consumePrize:fe}=ne,{settings:he,isDrawing:we,drawProgress:ke,startDrawing:je,stopDrawing:Ce,updateDrawProgress:Pe}=re,Me=i(()=>ye()),ze=i(()=>{const e=Math.min(ue.value.length,20);return Array.from({length:e},(e,t)=>t+1)});let De=null;const Qe=()=>{if(0===ue.value.length||0===ce.value)return;je(),oe.value=[],de.value=[],pe();let e=0;const t=50/he.animationDuration*100;De=setInterval(()=>{if(e+=t,Pe(e),e<90){pe();const e=Math.floor(Math.random()*ue.value.length),t=ue.value[e];me(t.id)}e>=100&&Ae()},50)},We=()=>{De&&(clearInterval(De),De=null),Ce(),oe.value=[]},Ae=()=>{De&&(clearInterval(De),De=null),Ce(),pe();const e=[...ue.value],t=[],l=Me.value?Math.min(ce.value,Me.value.remainingQuantity,e.length):Math.min(ce.value,e.length);for(let a=0;a<l;a++){const l=Math.floor(Math.random()*e.length),a=e.splice(l,1)[0];Me.value&&t.push({...a,prizeWon:Me.value.title,isWinner:!0})}oe.value=t},Ie=()=>{if(oe.value.length>0&&Me.value){oe.value.forEach((e,t)=>{xe(e.id,e.prizeWon)});for(let e=0;e<oe.value.length;e++)Me.value.remainingQuantity>0&&fe(Me.value.id);oe.value=[],pe()}},_e=()=>{oe.value=[],pe(),ue.value.length>0&&setTimeout(()=>Qe(),500)},qe=()=>{confirm("æ‚¨ç¢ºå®šè¦é‡è¨­æ‰€æœ‰ç²çè€…å—ï¼Ÿæ­¤æ“ä½œç„¡æ³•å¾©åŸã€‚")&&(be(),ne.resetAllPrizes(),oe.value=[],pe())};return n(()=>ue.value.length,e=>{ce.value>e&&(ce.value=Math.max(1,e))}),r(()=>{De&&clearInterval(De),ue.value.length>0&&(ce.value=1)}),(e,t)=>{const l=v("router-link");return C(),o("div",z,[c("header",D,[c("div",Q,[c("div",W,[t[2]||(t[2]=c("h1",{class:"text-2xl font-bold text-gray-900"},"ğŸ¯ å¹¸é‹æŠ½ç",-1)),d(l,{to:"/",class:"btn-secondary"},{default:u(()=>[...t[1]||(t[1]=[k("â† è¿”å›é¦–é ",-1)])]),_:1})])])]),c("main",A,[c("div",I,[c("div",_,[c("div",null,[t[3]||(t[3]=c("h2",{class:"text-xl font-semibold text-gray-900"},"æº–å‚™æŠ½çï¼Ÿ",-1)),c("p",q,"å‰©é¤˜ "+m(x(ue).length)+" ååƒèˆ‡è€…",1)]),c("div",E,[c("div",F,[t[4]||(t[4]=c("label",{class:"text-sm font-medium text-gray-700 whitespace-nowrap"},"æŠ½å–äººæ•¸:",-1)),p(c("select",{"onUpdate:modelValue":t[0]||(t[0]=e=>ce.value=e),disabled:x(we),class:y(["p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm",{"opacity-50 cursor-not-allowed":x(we)}])},[(C(!0),o(f,null,h(ze.value,e=>(C(),o("option",{key:e,value:e},m(e)+" å ",9,S))),128))],10,N),[[b,ce.value]])]),c("div",T,[x(we)?(C(),o("button",{key:1,onClick:We,class:"btn-danger px-8 py-3 text-lg font-semibold"}," â¹ï¸ åœæ­¢æŠ½ç ")):(C(),o("button",{key:0,onClick:Qe,disabled:0===x(ue).length||0===ce.value,class:y(["btn-primary px-8 py-3 text-lg font-semibold",{"opacity-50 cursor-not-allowed":0===x(ue).length||0===ce.value}])}," ğŸ² æŠ½å– "+m(ce.value)+" å ",11,U)),x(ve).length>0?(C(),o("button",{key:2,onClick:qe,class:"btn-secondary"}," ğŸ”„ é‡è¨­æ‰€æœ‰ ")):g("",!0)])])]),x(we)?(C(),o("div",V,[c("div",B,[c("div",{class:"bg-blue-600 h-2 rounded-full transition-all duration-100",style:w({width:x(ke)+"%"})},null,4)]),c("p",G," æ­£åœ¨æŠ½å– "+m(ce.value)+" åç²çè€…... ",1)])):g("",!0)]),Me.value?(C(),o("div",H,[t[5]||(t[5]=c("h3",{class:"text-lg font-semibold text-gray-900 mb-2"},"ç•¶å‰çå“",-1)),c("div",J,m(Me.value.title),1),c("p",K,m(Me.value.description),1),c("div",L,[c("div",O," å‰©é¤˜çå“: "+m(Me.value.remainingQuantity)+" / "+m(Me.value.quantity),1),c("div",R," æœ¬æ¬¡æŠ½å–: "+m(Math.min(ce.value,Me.value.remainingQuantity))+" å ",1)]),ce.value>Me.value.remainingQuantity?(C(),o("div",X," âš ï¸ æŠ½å–äººæ•¸è¶…éå‰©é¤˜çå“æ•¸é‡ï¼Œå°‡èª¿æ•´ç‚º "+m(Me.value.remainingQuantity)+" å ",1)):g("",!0)])):g("",!0),1===oe.value.length?(C(),o("div",Y,[t[6]||(t[6]=c("div",{class:"text-6xl mb-4"},"ğŸ‰",-1)),t[7]||(t[7]=c("h3",{class:"text-3xl font-bold text-gray-900 mb-4"},"æ­å–œï¼",-1)),c("div",Z,[c("div",$,[d(M,{participant:oe.value[0]},null,8,["participant"])])]),c("div",ee,"ç²ç: "+m(oe.value[0].prizeWon),1),c("div",{class:"mt-6 flex justify-center gap-4"},[c("button",{onClick:Ie,class:"btn-primary"},"ç¢ºèªç²çè€…"),c("button",{onClick:_e,class:"btn-secondary"},"é‡æ–°æŠ½ç")])])):oe.value.length>1?(C(),o("div",te,[t[8]||(t[8]=c("div",{class:"text-center"},[c("div",{class:"text-6xl mb-4"},"ğŸ‰"),c("h3",{class:"text-3xl font-bold text-gray-900 mb-6"},"æ­å–œæ‰€æœ‰ç²çè€…ï¼")],-1)),c("div",le,[(C(!0),o(f,null,h(oe.value,e=>(C(),j(M,{key:e.id,participant:e},null,8,["participant"]))),128))]),c("div",{class:"flex justify-center gap-4"},[c("button",{onClick:Ie,class:"btn-primary"},"ç¢ºèªæ‰€æœ‰ç²çè€…"),c("button",{onClick:_e,class:"btn-secondary"},"é‡æ–°æŠ½ç")])])):g("",!0),c("div",ae,[(C(!0),o(f,null,h(x(ue),e=>{var t;return C(),j(M,{key:e.id,participant:e,"is-drawing":x(we),"is-selected":(null==(t=x(ge))?void 0:t.id)===e.id||oe.value.some(t=>t.id===e.id),onClick:t=>x(me)(e.id)},null,8,["participant","is-drawing","is-selected","onClick"])}),128))]),0===x(ue).length?(C(),o("div",se,[t[10]||(t[10]=c("div",{class:"text-6xl mb-4"},"ğŸ¯",-1)),t[11]||(t[11]=c("h3",{class:"text-xl font-semibold text-gray-900 mb-2"},"ç„¡å¯ç”¨åƒèˆ‡è€…",-1)),t[12]||(t[12]=c("p",{class:"text-gray-600 mb-4"},"æ–°å¢ä¸€äº›åƒèˆ‡è€…ä»¥é–‹å§‹å¹¸é‹æŠ½çï¼",-1)),d(l,{to:"/",class:"btn-primary"},{default:u(()=>[...t[9]||(t[9]=[k("æ–°å¢åƒèˆ‡è€…",-1)])]),_:1})])):g("",!0)])])}}});export{ie as default};
