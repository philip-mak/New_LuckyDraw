import{d as e,u as l,a as t,b as a,c as s,r,s as i,w as n,o,e as c,f as d,g as u,h as g,i as v,n as x,t as m,j as p,k as b,l as y,m as f,p as h,v as w,q as k,F as z,x as P,y as j,z as C}from"./index-Ca_idaoA.js";import{u as M}from"./settings-7vYED1VO.js";import{P as W}from"./ParticipantCard-CHQ5UmJk.js";const D={class:"min-h-screen christmas-bg"},A={class:"bg-white shadow-sm border-b border-gray-200"},I={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"},_={class:"flex justify-between items-center py-4"},E={key:0,class:"text-sm text-gray-600 mt-1"},S={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8"},$={class:"card p-6 mb-8"},q={class:"flex flex-col md:flex-row justify-between items-center gap-4"},F={class:"text-gray-600"},N={class:"flex flex-col sm:flex-row gap-3 items-center"},Q={class:"flex items-center gap-2"},T=["disabled"],U=["value"],V={class:"flex gap-3"},B=["disabled"],G={key:0,class:"mt-4"},H={class:"w-full bg-gray-200 rounded-full h-2"},J={class:"text-center text-sm text-gray-600 mt-2"},K={key:0,class:"card p-6 mb-8"},L={class:"space-y-3"},O={class:"flex items-center gap-3"},R={class:"font-semibold text-gray-900"},X={class:"text-sm text-gray-600"},Y={class:"text-right"},Z={class:"text-lg font-bold text-purple-600"},ee={key:0,class:"text-center text-sm text-gray-500 mt-3"},le={key:1,class:"card p-8 mb-8 text-center bg-gradient-to-r from-yellow-50 to-orange-50 border-2 border-yellow-200 relative z-30"},te={class:"flex justify-center mb-6"},ae={class:"w-64"},se={class:"text-lg font-semibold text-purple-600 mb-4"},re={key:2,class:"card p-8 mb-8 bg-gradient-to-r from-yellow-50 to-orange-50 border-2 border-yellow-200 relative z-30"},ie={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 mb-6"},ne={class:"mt-2 px-3 py-1.5 bg-purple-100 border border-purple-300 rounded-lg text-center"},oe={class:"text-xs font-medium text-purple-900"},ce={class:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4"},de={key:3,class:"text-center py-12"},ue=e({__name:"Draw",setup(e){const ue=l(),ge=t(),ve=a(),xe=M(),me=s(()=>ve.activeSession),pe=r([]),be=r(1),ye=r([]),fe=r([]),{activeParticipants:he,winners:we,selectedParticipant:ke}=i(ue),ze=s(()=>ge.availablePrizes),{selectParticipant:Pe,markAsWinner:je,clearSelection:Ce,resetAllWinners:Me}=ue,{getNextAvailablePrize:We,consumePrize:De,returnPrize:Ae}=ge,{settings:Ie,isDrawing:_e,drawProgress:Ee,startDrawing:Se,stopDrawing:$e,updateDrawProgress:qe}=xe;s(()=>We());const Fe=s(()=>{const e=Math.min(he.value.length,20);return Array.from({length:e},(e,l)=>l+1)});let Ne=null;const Qe=()=>{if(0===he.value.length||0===be.value)return;Se(),pe.value=[],ye.value=[],fe.value=[],Ce();let e=0;const l=50/Ie.animationDuration*100;Ne=setInterval(()=>{if(e+=l,qe(e),e<90){Ce();const e=Math.floor(Math.random()*he.value.length),l=he.value[e];Pe(l.id)}e>=100&&Ue()},50)},Te=()=>{Ne&&(clearInterval(Ne),Ne=null),$e(),pe.value=[]},Ue=()=>{Ne&&(clearInterval(Ne),Ne=null),$e(),Ce();const e=[...he.value],l=[],t=Math.min(be.value,e.length);for(let a=0;a<t;a++){const t=ge.availablePrizes;if(0===t.length){alert(`âš ï¸ åªæœ‰ ${l.length} å€‹å¯ç”¨çå“ï¼\nå·²æŠ½å– ${l.length} ä½ç²çè€…ã€‚`);break}const a=t[0],s=Math.floor(Math.random()*e.length),r=e.splice(s,1)[0];l.push({...r,prizeWon:a.title,isWinner:!0}),De(a.id),fe.value.push(a.id)}pe.value=l},Ve=()=>{pe.value.length>0&&(pe.value.forEach(e=>{je(e.id,e.prizeWon)}),pe.value=[],fe.value=[],Ce())},Be=()=>{fe.value.forEach(e=>{Ae(e)}),pe.value=[],fe.value=[],Ce(),he.value.length>0&&setTimeout(()=>Qe(),500)},Ge=()=>{confirm("æ‚¨ç¢ºå®šè¦é‡è¨­æ‰€æœ‰ç²çè€…å—ï¼Ÿæ­¤æ“ä½œç„¡æ³•å¾©åŸã€‚")&&(Me(),ge.resetAllPrizes(),pe.value=[],Ce())};return n(()=>he.value.length,e=>{be.value>e&&(be.value=Math.max(1,e))}),o(()=>{Ne&&clearInterval(Ne),he.value.length>0&&(be.value=1)}),(e,l)=>{const t=b("router-link");return C(),c("div",D,[d("header",A,[d("div",I,[d("div",_,[d("div",null,[l[2]||(l[2]=d("h1",{class:"text-2xl font-bold text-gray-900"},"ğŸ¯ å¹¸é‹æŠ½ç",-1)),me.value?(C(),c("p",E,[l[1]||(l[1]=v(" å ´æ¬¡: ",-1)),d("span",{class:"font-medium",style:x({color:me.value.color})},m(me.value.name),5)])):g("",!0)]),u(t,{to:"/",class:"btn-secondary"},{default:p(()=>[...l[3]||(l[3]=[v("â† è¿”å›é¦–é ",-1)])]),_:1})])])]),d("main",S,[l[15]||(l[15]=y('<div class="mb-6 p-4 bg-blue-50 border border-blue-200 rounded-lg"><div class="flex items-start gap-3"><div class="text-2xl">â„¹ï¸</div><div class="flex-1"><h4 class="font-semibold text-blue-900 mb-1">æŠ½çè¦å‰‡</h4><ul class="text-sm text-blue-800 space-y-1"><li>â€¢ çå“å°‡æŒ‰ç…§<strong>å„ªå…ˆé †åº</strong>åˆ†é…ï¼ˆå¾ä¸Šåˆ°ä¸‹ï¼‰</li><li>â€¢ ç•¶çå“æ•¸é‡ç‚º1æ™‚ï¼Œç³»çµ±æœƒ<strong>è‡ªå‹•åˆ‡æ›</strong>åˆ°ä¸‹ä¸€å€‹çå“</li><li>â€¢ æ¯ä½ç²çè€…æœƒé¡¯ç¤ºå°æ‡‰çš„<strong>çå“åç¨±</strong></li><li>â€¢ å¯ä¸€æ¬¡æŠ½å–å¤šåç²çè€…ï¼Œæ¯äººå¯èƒ½ç²å¾—ä¸åŒçå“</li></ul></div></div></div>',1)),d("div",$,[d("div",q,[d("div",null,[l[4]||(l[4]=d("h2",{class:"text-xl font-semibold text-gray-900"},"æº–å‚™æŠ½çï¼Ÿ",-1)),d("p",F,"å‰©é¤˜ "+m(f(he).length)+" ååƒèˆ‡è€…",1)]),d("div",N,[d("div",Q,[l[5]||(l[5]=d("label",{class:"text-sm font-medium text-gray-700 whitespace-nowrap"},"æŠ½å–äººæ•¸:",-1)),h(d("select",{"onUpdate:modelValue":l[0]||(l[0]=e=>be.value=e),disabled:f(_e),class:k(["p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm",{"opacity-50 cursor-not-allowed":f(_e)}])},[(C(!0),c(z,null,P(Fe.value,e=>(C(),c("option",{key:e,value:e},m(e)+" å ",9,U))),128))],10,T),[[w,be.value]])]),d("div",V,[f(_e)?(C(),c("button",{key:1,onClick:Te,class:"btn-danger px-8 py-3 text-lg font-semibold"}," â¹ï¸ åœæ­¢æŠ½ç ")):(C(),c("button",{key:0,onClick:Qe,disabled:0===f(he).length||0===be.value,class:k(["btn-primary px-8 py-3 text-lg font-semibold",{"opacity-50 cursor-not-allowed":0===f(he).length||0===be.value}])}," ğŸ² æŠ½å– "+m(be.value)+" å ",11,B)),f(we).length>0?(C(),c("button",{key:2,onClick:Ge,class:"btn-secondary"}," ğŸ”„ é‡è¨­æ‰€æœ‰ ")):g("",!0)])])]),f(_e)?(C(),c("div",G,[d("div",H,[d("div",{class:"bg-blue-600 h-2 rounded-full transition-all duration-100",style:x({width:f(Ee)+"%"})},null,4)]),d("p",J," æ­£åœ¨æŠ½å– "+m(be.value)+" åç²çè€…... ",1)])):g("",!0)]),ze.value.length>0?(C(),c("div",K,[l[7]||(l[7]=d("h3",{class:"text-lg font-semibold text-gray-900 mb-4 text-center"},"ğŸ“‹ å¾…æŠ½çå“æ¸…å–®ï¼ˆæŒ‰å„ªå…ˆé †åºï¼‰",-1)),d("div",L,[(C(!0),c(z,null,P(ze.value.slice(0,5),(e,t)=>(C(),c("div",{key:e.id,class:k(["flex items-center justify-between p-4 rounded-lg border-2 transition-all",0===t?"bg-purple-50 border-purple-300":"bg-gray-50 border-gray-200"])},[d("div",O,[d("div",{class:k(["w-8 h-8 rounded-full flex items-center justify-center text-white font-bold text-sm",0===t?"bg-purple-600":"bg-gray-400"])},m(t+1),3),d("div",null,[d("div",R,m(e.title),1),d("div",X,m(e.description),1)])]),d("div",Y,[d("div",Z,m(e.remainingQuantity),1),l[6]||(l[6]=d("div",{class:"text-xs text-gray-500"},"å‰©é¤˜æ•¸é‡",-1))])],2))),128))]),ze.value.length>5?(C(),c("div",ee," é‚„æœ‰ "+m(ze.value.length-5)+" é …çå“... ",1)):g("",!0)])):g("",!0),1===pe.value.length?(C(),c("div",le,[l[8]||(l[8]=d("div",{class:"text-6xl mb-4"},"ğŸ‰",-1)),l[9]||(l[9]=d("h3",{class:"text-3xl font-bold text-gray-900 mb-4"},"æ­å–œï¼",-1)),d("div",te,[d("div",ae,[u(W,{participant:pe.value[0]},null,8,["participant"])])]),d("div",se,"ç²ç: "+m(pe.value[0].prizeWon),1),d("div",{class:"mt-6 flex justify-center gap-4"},[d("button",{onClick:Ve,class:"btn-primary"},"ç¢ºèªç²çè€…"),d("button",{onClick:Be,class:"btn-secondary"},"é‡æ–°æŠ½ç")])])):pe.value.length>1?(C(),c("div",re,[l[10]||(l[10]=d("div",{class:"text-center"},[d("div",{class:"text-6xl mb-4"},"ğŸ‰"),d("h3",{class:"text-3xl font-bold text-gray-900 mb-6"},"æ­å–œæ‰€æœ‰ç²çè€…ï¼")],-1)),d("div",ie,[(C(!0),c(z,null,P(pe.value,e=>(C(),c("div",{key:e.id,class:"relative"},[u(W,{participant:e},null,8,["participant"]),d("div",ne,[d("div",oe,"ğŸ "+m(e.prizeWon),1)])]))),128))]),d("div",{class:"flex justify-center gap-4"},[d("button",{onClick:Ve,class:"btn-primary"},"ç¢ºèªæ‰€æœ‰ç²çè€…"),d("button",{onClick:Be,class:"btn-secondary"},"é‡æ–°æŠ½ç")])])):g("",!0),d("div",ce,[(C(!0),c(z,null,P(f(he),e=>{var l;return C(),j(W,{key:e.id,participant:e,"is-drawing":f(_e),"is-selected":(null==(l=f(ke))?void 0:l.id)===e.id||pe.value.some(l=>l.id===e.id),onClick:l=>f(Pe)(e.id)},null,8,["participant","is-drawing","is-selected","onClick"])}),128))]),0===f(he).length?(C(),c("div",de,[l[12]||(l[12]=d("div",{class:"text-6xl mb-4"},"ğŸ¯",-1)),l[13]||(l[13]=d("h3",{class:"text-xl font-semibold text-gray-900 mb-2"},"ç„¡å¯ç”¨åƒèˆ‡è€…",-1)),l[14]||(l[14]=d("p",{class:"text-gray-600 mb-4"},"æ–°å¢ä¸€äº›åƒèˆ‡è€…ä»¥é–‹å§‹å¹¸é‹æŠ½çï¼",-1)),u(t,{to:"/",class:"btn-primary"},{default:p(()=>[...l[11]||(l[11]=[v("æ–°å¢åƒèˆ‡è€…",-1)])]),_:1})])):g("",!0)])])}}});export{ue as default};
